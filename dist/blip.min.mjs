/**
 * blip@1.0.0 https://github.com/EvitcaStudio/Blip
 * Compiled 1/9/2024, 9:42:33 AM UTC
 * 
 * blip is licensed under a MIT styled License. See LICENSE.md for more info.
 * 
 * Copyright 2024, Evitca Studio, All Rights Reserved
 */
 var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={},s=(e.d(t,{v:()=>y}),{d:(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)}),i={};s.d(i,{Y:()=>o});class o{constructor(e){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let e=0;e<=255;e++)this.FG_COLORS[e]="[38;5;"+e+"m";this.BG_COLORS={};for(let e=0;e<=255;e++)this.BG_COLORS[e]="[48;5;"+e+"m";Array.isArray(e)&&this.registerTypes(e)}prefix(e){return"string"==typeof e&&(this.currentType=e),this}message(t="log",...s){var i=this.currentType||"";if(0===i.length)console[t](...s);else{var o=i.length>=this.TYPE_SPACER_LENGTH;let e=this.types[i.toLowerCase()]?this.types[i.toLowerCase()]:this.types.default;var n=e.includes("");n||(e="color: "+e),!globalThis.window||n?console[t](e+i+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-i.length,o?1:0))+"|"+this.RESET,...s):console[t]("%c"+i+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-i.length,o?1:0))+"|",e,...s)}this.currentType=""}log(...e){this.message("log",...e)}info(...e){this.message("info",...e)}error(...e){this.message("error",...e)}warn(...e){this.message("warn",...e)}assert(...e){console.assert(...e)}debug(...e){this.message("debug",...e)}count(e){console.count(e)}countReset(e){console.countReset(e)}table(e,t){console.table(e,t)}time(e){this.message("time",e)}timeLog(e){this.message("timeLog",e)}timeEnd(e){this.message("timeEnd",e)}trace(...e){this.message("trace",...e)}group(e){this.message("group",e)}groupCollapsed(e){console.groupCollapsed(e)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(e,t){this.types[e]||"string"==typeof e&&"string"==typeof t&&(this.types[e.toLowerCase()]=t)}registerTypes(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.registerType(t[e].type,t[e].ansi)}unregisterType(e){this.types[e]&&delete this.types[e]}}var n=i.Y,r={d:(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},a={},l=(r.d(a,{P:()=>m}),{d:(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)}),c={};l.d(c,{Y:()=>h});class h{constructor(e){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let e=0;e<=255;e++)this.FG_COLORS[e]="[38;5;"+e+"m";this.BG_COLORS={};for(let e=0;e<=255;e++)this.BG_COLORS[e]="[48;5;"+e+"m";Array.isArray(e)&&this.registerTypes(e)}prefix(e){return"string"==typeof e&&(this.currentType=e),this}message(t="log",...s){var i=this.currentType||"";if(0===i.length)console[t](...s);else{var o=i.length>=this.TYPE_SPACER_LENGTH;let e=this.types[i.toLowerCase()]?this.types[i.toLowerCase()]:this.types.default;var n=e.includes("");n||(e="color: "+e),!globalThis.window||n?console[t](e+i+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-i.length,o?1:0))+"|"+this.RESET,...s):console[t]("%c"+i+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-i.length,o?1:0))+"|",e,...s)}this.currentType=""}log(...e){this.message("log",...e)}info(...e){this.message("info",...e)}error(...e){this.message("error",...e)}warn(...e){this.message("warn",...e)}assert(...e){console.assert(...e)}debug(...e){this.message("debug",...e)}count(e){console.count(e)}countReset(e){console.countReset(e)}table(e,t){console.table(e,t)}time(e){this.message("time",e)}timeLog(e){this.message("timeLog",e)}timeEnd(e){this.message("timeEnd",e)}trace(...e){this.message("trace",...e)}group(e){this.message("group",e)}groupCollapsed(e){console.groupCollapsed(e)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(e,t){this.types[e]||"string"==typeof e&&"string"==typeof t&&(this.types[e.toLowerCase()]=t)}registerTypes(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.registerType(t[e].type,t[e].ansi)}unregisterType(e){this.types[e]&&delete this.types[e]}}var p=c.Y;class g{version="1.0.0";static DiobConstructor=(()=>{var e=VYLO.newDiob(),t=e.__proto__.constructor;return VYLO.delDiob(e),t})();collectionLimit=20;static WARNING_LIMIT=200;basicCollection=[];constructor(){this.logger=new p,this.logger.registerType("Collector-Module","#ff6600")}setMaxLimit(e){"number"==typeof e&&(this.collectionLimit=Math.round(e),this.collectionLimit>m.WARNING_LIMIT)&&this.logger.prefix("Collector-Module").warn("Collector: This is a high value to use for a max limit in a collection! Only use this high of a value if you know what you are doing.")}collect(t,s){const i=Array.isArray(t);if(t)if("object"!=typeof t||i||Object.keys(t).length)if(t.type||i){if(Array.isArray(s)){if(s.includes(t))return void this.logger.prefix("Collector-Module").error("Collector: OOPS! %cpCollected","font-weight: bold","already belongs to the provided collection.");if(i&&!t.length)return void this.logger.prefix("Collector-Module").error("Collector: OOPS! %cpCollected","font-weight: bold","is an array. But it contains nothing to recycle.");if(i){if(s.length>=this.collectionLimit){for(let e=t.length-1;0<=e;e--){const i=t[e];i instanceof g.DiobConstructor?(this.cleanInstance(i),VYLO.delDiob(i)):(this.cleanInstance(i),VYLO.delObject(i))}return}if(t.length+s.length>this.collectionLimit)for(let e=t.length-(this.collectionLimit-s.length);0<e;e--){const s=t[e];s instanceof g.DiobConstructor?(t.splice(e,1),this.cleanInstance(s),VYLO.delDiob(s)):(t.splice(e,1),this.cleanInstance(s),VYLO.delObject(s))}for(let e=t.length-1;0<=e;e--){var o=t[e];"function"==typeof o.onCollected&&o.onCollected(),s.includes(o)||s.push(o),this.cleanInstance(o)}return}return s.length>=this.collectionLimit?void(t instanceof g.DiobConstructor?(this.cleanInstance(t),VYLO.delDiob(t)):(this.cleanInstance(t),VYLO.delObject(t))):("function"==typeof t.onCollected&&t.onCollected(),s.includes(t)||s.push(t),void this.cleanInstance(t))}this.logger.prefix("Collector-Module").error("Collector: Invalid variable type passed for the %cpCollection","font-weight: bold","parameter. Expecting an array. Collect failed.")}else this.logger.prefix("Collector-Module").error("Collector: OOPS! %cpCollected","font-weight: bold"," is not a valid object It has no type.");else this.logger.prefix("Collector-Module").error("Collector: OOPS! %cpCollected","font-weight: bold"," is an empty object and will NOT be collected.");else this.logger.prefix("Collector-Module").error("Collector: There was nothing passed for the %cpCollected","font-weight: bold","parameter. Expecting a instance or an object.")}isInCollection(t="Diob",s=1,i=[],...o){var n,r=[];let a=0,l=s,c=!VYLO.Type.getVariable(t,"baseType");if(i.length){for(let e=i.length-1;0<=e;e--)l&&(n=i[e]).type===t&&(i.splice(e,1),r.push(n),n.collectorCollected=!1,"function"==typeof n.onDumped&&n.onDumped(...o),a++,l--);if(s>a){const i=s-a;for(let e=0;e<i;e++)r.push(c?VYLO.newObject(t,...o):VYLO.newDiob(t,...o))}}else for(let e=0;e<s;e++)r.push(c?VYLO.newObject(t,...o):VYLO.newDiob(t,...o));return 1===r.length?r.pop():r}cleanInstance(e){if(e){if(e instanceof g.DiobConstructor){var t="Interface"===e.baseType||"Interface"===e.type||VYLO.Type.getInheritances(e.type).includes("Interface");e.color&&("object"==typeof e.color&&e.color.constructor===Object?(e.color.tint=16777215,e.color=e.color):e.color=null),"object"==typeof e.scale?(e.scale.x=e.scale.y=1,e.scale=e.scale):e.scale=1,t&&(e.hide(),"server"!==VYLO.World.getCodeType())&&VYLO.Client.removeInterfaceElement(e.getInterfaceName(),e,!0),e.playAnimation(),e.setTransition(),e.angle=0,e.alpha=1,e.xPos=0,e.yPos=0,t||(e.mapName=null,e.setLoc()),e.text="",e.composite="","Movable"===e.baseType&&e.move();for(const t of e.getOverlays())e.removeOverlay(t.type);for(const t of e.getFilters())e.removeFilter(t)}e.collectorCollected=!0,e.inTicker=null,"function"==typeof e.clean&&e.clean()}}}const m=new g;var u=a.P;class f{static GAME_SIZE=VYLO?VYLO.World.getGameSize():{width:960,height:540};static GAME_SIZE_HALF={width:f.GAME_SIZE.width/2,height:f.GAME_SIZE.height/2};static CENTER_SCREEN_POSITION={x:f.GAME_SIZE.width/2,y:f.GAME_SIZE.height/2};static TILE_SIZE=32;static MAX_BLIPS=200;static storedBlips=[];static getAngle(e,t,s){let i,o;if(s){const s=e.icon?e.icon.width:32,n=e.icon?e.icon.height:32;i=e.y+n/2-(t.y+n/2),o=e.x+s/2-(t.x+s/2)}else i=e.y-t.y,o=e.x-t.x;return-Math.atan2(i,o)-Math.PI}static getDistance(e,t,s){let i,o;if(s){const s=e.icon?e.icon.width:32,n=e.icon?e.icon.height:32;i=e.y+n/2-(t.y+n/2),o=e.x+s/2-(t.x+s/2)}else i=e.y-t.y,o=e.x-t.x;return Math.sqrt(o*o+i*i)}static getDirection(e){return["east","southeast","south","southwest","west","northwest","north","northeast"][Math.abs(Math.floor(e*(180/Math.PI)/45+.5))%8]}version="1.0.0";paused=!1;activeBlips=[];constructor(){this.interfaceHandle=Math.random()*Math.PI/2+"-blip-interface",this.logger=new n,this.logger.registerType("BlipComponent-Module","#ff6600"),VYLO.Client.createInterface(this.interfaceHandle),VYLO.Client.showInterface(this.interfaceHandle);const e=this,t=function(){e.manageBlips(),requestAnimationFrame(t)};requestAnimationFrame(t)}track(e){this.activeBlips.includes(e)||this.activeBlips.push(e)}untrack(e){this.activeBlips.includes(e)&&this.activeBlips.splice(this.activeBlips.indexOf(e),1)}pause(){this.paused=!0}resume(){this.paused=!1}manageBlips(){if(!this.paused)for(const h of this.activeBlips){var t=h.icon?h.icon.width:32,s=h.icon?h.icon.height:32,i=h.mapInstance.icon?h.mapInstance.icon.width:32,o=h.mapInstance.icon?h.mapInstance.icon.height:32,t=(h.mapInstance.getScreenPos(h.screenPos),VYLO.Math.clamp((h.screenPos.x+scrM.xMapPos+i/2-t/VYLO.Client.mapView.scale.x)*VYLO.Client.mapView.scale.x,-t+h.settings.buffer,f.GAME_SIZE.width-t-h.settings.buffer)),s=VYLO.Math.clamp((h.screenPos.y+scrM.yMapPos+o/2-s/2/VYLO.Client.mapView.scale.y)*VYLO.Client.mapView.scale.y,-s/2+h.settings.buffer,f.GAME_SIZE.height-s/2-h.settings.buffer),n=Math.round(f.getDistance(VYLO.Client.mob,h.mapInstance,!0)),r=f.getAngle(VYLO.Client.mob,h.mapInstance,!0),a=f.getDirection(r);let e=!1;if(h.angle=r,h.setPos(t,s),n<h.settings.maxDistance){var l=n>=(f.GAME_SIZE_HALF.width-i/2)/VYLO.Client.mapView.scale.x,c=n>=(f.GAME_SIZE_HALF.height-o/2)/VYLO.Client.mapView.scale.y;switch(a){case"north":case"south":c&&(e=!0);break;case"east":case"west":l&&(e=!0);break;case"northwest":case"northeast":case"southwest":case"southeast":(l||c)&&(e=!0)}}e?h.show():h.hide()}}hideBlips(){for(const e of this.activeBlips)e.hide()}}const d=new f;class y{static BUFFER=25;static MAX_DIST=1e3;static MAX_DISPLAY=9999;instance=null;constructor(e,t={atlasName:"",iconName:""},s={buffer:y.BUFFER,showsDistance:!1,maxDistance:y.MAX_DIST,alwaysOnTop:!1},i){var o;d.activeBlips.length>=f.MAX_BLIPS?d.logger.prefix("BlipComponent-Module").log("Max blip limit reached"):((o=u.isInCollection("Interface",1,f.storedBlips)).touchOpacity=0,o.mouseOpacity=0,o.preventAutoScale=!1,o.anchor.x=1,o.anchor.y=.5,o.atlasName=t.atlasName,o.iconName=t.iconName,o.mapInstance=e,o.screenPos={x:0,y:0},o.settings={buffer:s.buffer,showsDistance:s.showsDistance,maxDistance:s.maxDistance},s.alwaysOnTop&&(o.plane=y.MAX_DISPLAY,o.layer=y.MAX_DISPLAY),VYLO.Client.addInterfaceElement(o,d.interfaceHandle,e.id+"- blip"),o.hide(),d.track(o),this.instance=o)}remove(){this.instance&&this.instance.hide(),d.untrack(this.instance)}}var E=t.v;export{E as BlipComponent};