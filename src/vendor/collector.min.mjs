/**
* A recycle manager
* @class CollectorSingleton
* @license Collector does not have a license at this time. For licensing contact the author
* @author https://github.com/doubleactii
* Copyright (c) 2023 Evitca Studio
*/
class CollectorSingleton{static version="1.0.0";static DiobConstructor=(()=>{var e=VYLO.newDiob(),o=e.__proto__.constructor;return VYLO.delDiob(e),o})();constructor(){this.debugging=!1,this.collectionLimit=20,this.WARNING_LIMIT=200,this.basicCollection=[]}setMaxLimit(e){"number"==typeof e&&(this.collectionLimit=Math.round(e),this.collectionLimit>this.WARNING_LIMIT)&&console.warn("Collector: This is a high value to use for a max limit in a collection! Only use this high of a value if you know what you are doing.")}collect(o,t){var e=Array.isArray(o);if(o)if("object"!=typeof o||e||Object.keys(o).length)if(o.type||e)if(Array.isArray(t))if(t.includes(o))this.debugging&&console.error("Collector: OOPS! %cpCollected","font-weight: bold","already belongs to the provided collection.");else if(e&&!o.length)console.error("Collector: OOPS! %cpCollected","font-weight: bold","is an array. But it contains nothing to recycle.");else if(e)if(t.length>=this.collectionLimit)for(let e=o.length-1;0<=e;e--){var l=o[e];l instanceof CollectorSingleton.DiobConstructor?(this.cleanInstance(l),VYLO.delDiob(l)):(this.cleanInstance(l),VYLO.delObject(l))}else{if(o.length+t.length>this.collectionLimit)for(let e=o.length-(this.collectionLimit-t.length);0<e;e--){var n=o[e];n instanceof CollectorSingleton.DiobConstructor?(o.splice(e,1),this.cleanInstance(n),VYLO.delDiob(n)):(o.splice(e,1),this.cleanInstance(n),VYLO.delObject(n))}for(let e=o.length-1;0<=e;e--){var c=o[e];"function"==typeof c.onCollected&&c.onCollected(),t.includes(c)||t.push(c),this.cleanInstance(c)}}else t.length>=this.collectionLimit?o instanceof CollectorSingleton.DiobConstructor?(this.cleanInstance(o),VYLO.delDiob(o)):(this.cleanInstance(o),VYLO.delObject(o)):("function"==typeof o.onCollected&&o.onCollected(),t.includes(o)||t.push(o),this.cleanInstance(o));else console.error("Collector: Invalid variable type passed for the %cpCollection","font-weight: bold","parameter. Expecting an array. Collect failed.");else console.error("Collector: OOPS! %cpCollected","font-weight: bold"," is not a valid object It has no type.");else console.error("Collector: OOPS! %cpCollected","font-weight: bold"," is an empty object and will NOT be collected.");else console.error("Collector: There was nothing passed for the %cpCollected","font-weight: bold","parameter. Expecting a instance or an object.")}isInCollection(o="Diob",t=1,l=[],...n){var c=[];let i=0,r=t;var s,a=!VYLO.Type.getVariable(o,"baseType");if(l.length){for(let e=l.length-1;0<=e;e--)r&&(s=l[e]).type===o&&(l.splice(e,1),c.push(s),s.collectorCollected=!1,"function"==typeof s.onDumped&&s.onDumped(...n),i++,r--);if(t>i){var h=t-i;for(let e=0;e<h;e++)c.push(a?VYLO.newObject(o,...n):VYLO.newDiob(o,...n))}}else for(let e=0;e<t;e++)c.push(a?VYLO.newObject(o,...n):VYLO.newDiob(o,...n));return 1===c.length?c.pop():c}cleanInstance(e){if(e){if(e instanceof CollectorSingleton.DiobConstructor){var o="Interface"===e.baseType||"Interface"===e.type||VYLO.Type.getInheritances(e.type).includes("Interface");e.color&&("object"==typeof e.color&&e.color.constructor===Object?(e.color.tint=16777215,e.color=e.color):e.color=null),"object"==typeof e.scale?(e.scale.x=e.scale.y=1,e.scale=e.scale):e.scale=1,o&&(e.hide(),"server"!==VYLO.World.getCodeType())&&VYLO.Client.removeInterfaceElement(e.getInterfaceName(),e,!0),e.playAnimation(),e.setTransition(),e.angle=0,e.alpha=1,e.xPos=0,e.yPos=0,o||(e.mapName=null,e.setLoc()),e.text="",e.composite="","Movable"===e.baseType&&e.move();for(const t of e.getOverlays())e.removeOverlay(t.type);for(const l of e.getFilters())e.removeFilter(l)}e.collectorCollected=!0,e.inTicker=null,"function"==typeof e.clean&&e.clean()}}toggleDebug(){this.debugging=!this.debugging}}const Collector=new CollectorSingleton;export{Collector};